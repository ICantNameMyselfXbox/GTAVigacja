<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GTAVigacja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css" rel="stylesheet" />
</head>
<body style="margin:0; padding:0;">
  <div id="map" style="position:absolute; top:0; bottom:0; width:100%;"></div>
  <img src="logo.png" style="position:absolute; bottom:10px; left:10px; width:200px;">

  <script>
    const ORS_API_KEY = '5b3ce3597851110001cf62483ac4f0d3ed6f4364838102a41d9258c5';

    const map = new maplibregl.Map({
      container: 'map',
      style: 'https://api.maptiler.com/maps/0196a9ff-ca5a-72a8-b5e3-71deec7a5e00/style.json?key=xZ5mRqiLKIk5P0G37FF9',
      center: [19.94, 50.05],
      zoom: 13
    });

    map.addControl(new maplibregl.NavigationControl());

    let start = null;
    let end = null;
    const markers = [];

    map.on('click', function(e) {
      const coords = [e.lngLat.lng, e.lngLat.lat];

      if (!start) {
        start = coords;
        addMarker(coords, 'start.png');
      } else if (!end) {
        end = coords;
        addMarker(coords, 'end.png');
        getRoute(start, end);
      } else {
        clearMap();
        start = coords;
        addMarker(coords, 'start.png');
        end = null;
      }
    });

    function addMarker(coords, iconFile) {
  const el = document.createElement('img');
  el.src = iconFile;
  el.style.width = '32px';
  el.style.height = '32px';
  el.style.objectFit = 'contain';

  const marker = new maplibregl.Marker({ element: el }).setLngLat(coords).addTo(map);
  markers.push(marker);
}

    function clearMap() {
      markers.forEach(marker => marker.remove());
      markers.length = 0;

      if (map.getLayer('route')) map.removeLayer('route');
      if (map.getSource('route')) map.removeSource('route');
    }

    function getRoute(start, end) {
      fetch('https://api.openrouteservice.org/v2/directions/foot-walking/geojson', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': ORS_API_KEY
        },
        body: JSON.stringify({
          coordinates: [start, end]
        })
      })
      .then(res => res.json())
      .then(data => {
        if (map.getLayer('route')) map.removeLayer('route');
        if (map.getSource('route')) map.removeSource('route');

        map.addSource('route', {
          type: 'geojson',
          data: data
        });

        map.addLayer({
          id: 'route',
          type: 'line',
          source: 'route',
          paint: {
            'line-color': '#a149ed',
            'line-width': 8
          }
        });
      })
      .catch(err => {
        console.error('Błąd wyznaczania trasy:', err);
        alert('Błąd podczas pobierania trasy.');
      });
    }
  </script>
</body>
</html>
